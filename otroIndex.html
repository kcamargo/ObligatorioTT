<!DOCTYPE html>
<html>
<head>
  <title>Proyecto Otro</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.1/jquery.mobile-1.2.1.min.css" />
  <script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
  <script>
  $(document).bind('mobileinit',function(){
    $.mobile.pushStateEnabled = false;
  });

  </script>
  <script src="http://code.jquery.com/mobile/1.2.1/jquery.mobile-1.2.1.min.js"></script>
</head>
<body>
  <!-- Expenses -->
  <script type="text/javascript">
    var db = window.openDatabase('BdFinzanzas', '1.0', 'Test DB', 2 * 1024 * 1024);

    $(document).ready(function() {
      bdStart();
      createBdAccount();
      loadExpensesCategories();
      loadIncomeCategories();

      /*
      * Set Up
      */
      $("#register-button").bind("tap", function () {
        $.mobile.loading("show");
        var user =  $("#userA").val();
        var password = $('#passwordA').val();
        var onSuccess = function () {
          $.mobile.loading("hide");
          $.mobile.changePage( "#menu", { transition: "slideup"} );
        };
        register(user, password, onSuccess);
      });

      $("#login-button").bind("tap", function () {
        $.mobile.loading("show");
        var user =  $("#userLogin").val();
        var password = $('#passwordLogin').val();
        var onSuccess = function () {
          $.mobile.loading("hide");
          $.mobile.changePage( "#menu", { transition: "slideup"} );
        };
        login(user, password, onSuccess);
      });

      // $("#addExpenses-button").bind("tap", function () {
      //   $.mobile.loading("show");
      //   var expAmount = $('#expensesAmount').val();
      //   var expDate =  $("#expensesDate").val();
      //   var expCategory = $('#category').val();
      //   var onSuccess = function () {
      //     $.mobile.loading("hide");
      //     $.mobile.changePage( "#menu", { transition: "slideup"} );
      //   };
      //   login(expAmount, expDate, expCategory, onSuccess);
      // });



  });

  function loadExpensesCategories(){
    $.ajax({
      type: "GET",
      dataType: "json",
      url: "http://finanzapersonal.tribus.com.uy/categoriasGastos",
      // success: function(data) {
      //   showListExpenses(data);
      // }
      success: showListExpenses
    });
  }

  function showListExpenses(expenses) {
    for (var i = 0; i < expenses.length ; i++) {
      $('#category').append("<option value="+ i +">" + expenses[i] +"</option>");
    }
  }

  function loadIncomeCategories(){
    $.ajax({
      type: "GET",
      dataType: "json",
      url: "http://finanzapersonal.tribus.com.uy/categoriasIngresos",
      success: showListIncome
    });
  }

  function showListIncome(income){
    for(var i = 0; i < income.length ; i++){
      $('#clientDdl').append("<option value="+ i +">" + income[i] +"</option>");
    }
  }

  function bdStart (onError, onSuccess) {
    db.transaction(function(tx){
      tx.executeSql("CREATE TABLE IF NOT EXISTS USERS(user unique, password unique)",[],function(tx,results){
        tx.executeSql("INSERT INTO USERS (user,password) values ('kari',1234)");
      });
    }, onError, onSuccess);
  }

  function createBdAccount (onError, onSuccess) {
    db.transaction(function(tx){
      tx.executeSql("CREATE TABLE IF NOT EXISTS ACCOUNT(tipo, importe, fecha, categoria)",[],function(tx,results){
      });
    }, onError, onSuccess);
  }
  /*
  * Database Access
  */

  function register(user, password, onSuccess) {
    db.transaction(function(tx) {
      tx.executeSql("INSERT INTO USERS(user,password) values ('"+ user + "','" + password +"')", [], onSuccess);
    });
  }

  // function login(user, password, onSuccess){
  //   db.transaction(function(tx){
  //     tx.executeSql("SELECT distinct users.name FROM USERS where users.password = '" + password + "' and users.name = '" + name + "'", [], onSuccess);
  //   });
  // }
  function addExpensesToAccount (importe, fecha, categoria, onSuccess){
    db.transaction(function(tx){
      tx.executeSql("INSERT INTO ACCOUNT (tipo, importe, fecha, categoria) values ('"+ "Gasto" + "','" + importe +"','" + fecha +"','"+ categoria +"')", [], onSuccess);
    });
  }
  function addIncomesToAccount (importe, fecha, categoria, onSuccess){
    db.transaction(function(tx){
      tx.executeSql("INSERT INTO ACCOUNT (tipo, importe, fecha, categoria) values ('"+ "Ingreso" + "','" + importe +"','" + fecha +"','"+ categoria +"')", [], onSuccess);
    });
  }




  </script>

  <div data-role="page" id="home">
    <div data-role="header">
      <h1>Login</h1>
    </div>
    <div data-role="main" class="ui-content">
      <form method="post" action="demoform.asp">
        <div class="ui-field-contain">
          <label for="userLogin">Usuario: </label>
          <input type="text" name="userLogin" id="userLogin">
        </div>
        <div class="ui-field-contain">
          <label for="passwordLogin">Contrasena: </label>
          <input type="text" name="passwordLogin" id="passwordLogin">
        </div>
        <div class="ui-field-contain">
          <p><a href="#register" data-role="link" data-inline="true">Registrarse</a></p>
        </div>
        <div class="ui-field-contain">
          <a id='login-button' data-role='button'>Entrar</a>
        </div>
      </form>
    </div>
    <div data-role="footer" data-position="fixed" data-id="footer">
      <h1>Footer Text</h1>
    </div>
  </div>

  <div data-role="page" id="register">
    <div data-role="header">
      <h1>Registro</h1>
    </div>
    <div data-role="main" class="ui-content">
      <form method="post">
        <div class="ui-field-contain">
          <label for="user">Nombre de Usuario: </label>
          <input type="text" name="user" id="userA">
        </div>
        <div class="ui-field-contain">
          <label for="password">Ingrese la contrasena: </label>
          <input type="text" name="password" id="passwordA">
        </div>
        <div class="ui-field-contain">
          <a id='register-button' data-role='button'>Entrar</a>
        </div>
      </form>
    </div>
    <div data-role="footer" data-position="fixed"  data-id="footer">
      <h1>Footer text</h1>
    </div>
  </div>

  <div data-role="page" id="firstEntry">
    <div data-role="header" data-add-back-btn="true">
      <h1>Menu</h1>
      <p><a href="#home" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right">Home</a></p>
    </div>
    <div data-role="main" class="ui-content">
      <div>
        <form method="post" action="demoform.asp">
          <div class="ui-field-contain">
            <label for="fullname">Nombre: </label>
            <input type="text" name="fullname" id="fullname">
          </div>
          <div class="ui-field-contain">
            <label for="currency">Moneda: </label>
            <select name="currency" id="currency" data-native-menu="false">
              <option value="usd">DÃ³lares</option>
              <option value="uyu">Peso Uruguayo</option>
            </select>
          </div>
          <div class="ui-field-contain">
            <label for="balance">Saldo inicial:</label>
            <input type="text" name="email" id="balance" placeholder="Ingrese el importe">
          </div>
          <div class="ui-field-contain">
            <a href="#menu" data-role="button"  data-theme="b">Guardar</a>
          </div>
        </div>
      </form>
    </div>
    <div data-role="footer" data-position="fixed"  data-id="footer">
      <h1>Footer Text</h1>
    </div>
  </div>

  <div data-role="page" id="menu">
    <div data-role="header" data-add-back-btn="true">
      <h1>Menu</h1>
      <p><a href="#home" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right">Home</a></p>
    </div>
    <div data-role="main" class="ui-content">
      <div data-role="controlgroup" data-type="vertical">
        <a href="#expenses" data-role="button">Agregar Gasto</a>
        <a href="#income" data-role="button">Agregar Ingreso</a>
        <a href="#account" data-role="button">Estado de cuenta</a>
      </div>
    </div>
    <div data-role="footer" data-position="fixed" data-id="footer">
      <h1>Footer Text</h1>
    </div>
  </div>

  <div data-role="page" id="expenses">
    <div data-role="header" data-add-back-btn="true">
      <h1>Gastos</h1>
      <p><a href="#menu" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right">Menu</a></p>
    </div>
    <div data-role="main" class="ui-content">
      <div>
        <form method="post" action="demoform.asp">
          <div class="ui-field-contain">
            <label for="expenseDate">Fecha: </label>
            <input type="date" name="expenseDate" id="expensesDate">
          </div>
          <div class="ui-field-contain">
            <label for="expenseAmount">Importe: </label>
            <input type="text" name="expenseAmount" id="expensesAmount">
          </div>
          <div class="ui-field-contain">
            <label for="categoryLabel">Categoria: </label>
            <select name="category" id="category" data-native-menu="false"></select>
          </div>
          <div class="ui-field-contain">
            <label for="switch">Repetir:</label>
            <input type="checkbox" data-role="flipswitch" name="switch" id="switch" data-inline="true" checked>
          </div>
          <div class="ui-field-contain" id="repeat">
            <label for="repeatTypeLabel">Cada: </label>
            <select name="repeatType" id="repeatType" data-native-menu="false">
              <option value="month">Mes</option>
              <option value="day">Dia</option>
              <option value="week">Semana</option>
            </select>
          </div>
          <div class="ui-field-contain">
            <label for="repeatDeadline">Termina en: </label>
            <input type="date" name="repeatDeadline" id="repeatDeadline">
          </div>
          <div class="ui-field-contain">
            <label for="noteExpenses">Nota: </label>
            <textarea name="noteExpenses" id="noteExpenses"></textarea>
          </div>
          <div class="ui-field-contain">
              <a id='addExpenses-button' data-role='button'>Entrar</a>
          </div>
        </div>
      </form>
    </div>
    <div data-role="footer" data-position="fixed"  data-id="footer">
      <h1>Footer Text</h1>
    </div>
  </div>

  <div data-role="page" id="income">
    <div data-role="header" data-add-back-btn="true">
      <h1>Ingresos</h1>
      <p><a href="#menu" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right">Menu</a></p>
    </div>
    <div data-role="main" class="ui-content">
      <form method="post" action="demoform.asp">
        <div class="ui-field-contain">
          <label for="incomeDate">Fecha: </label>
          <input type="date" name="incomeDate" id="incomeDate">
        </div>
        <div class="ui-field-contain">
          <label for="incomeAmount">Importe: </label>
          <input type="text" name="incomeAmount" id="incomeAmount">
        </div>
        <div class="ui-field-contain">
          <label for="clientLabel">Categoria: </label>
          <select name="clientDdl" id="clientDdl" data-native-menu="false">

          </select>
        </div>
        <div class="ui-field-contain">
          <a href="#AddClient" class="ui-btn ui-shadow ui-corner-all ui-icon-plus ui-btn-icon-notext" data-inline="true" data-mini="true"></a>
        </div>
        <div class="ui-field-contain">
          <label for="noteExpenses">Nota: </label>
          <textarea name="noteExpenses" id="noteExpenses"></textarea>
        </div>
        <div class="ui-field-contain">
          <a id='addIncome-button' data-role='button'>Guardar</a>
        </div>
      </form>
    </div>
    <div data-role="footer" data-position="fixed" data-id="footer">
      <h1>Footer Text</h1>
    </div>
  </div>

  <div data-role="page" id="transfer">
    <div data-role="header" data-add-back-btn="true">
      <h1>Ingresos</h1>
      <p><a href="#menu" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right">Menu</a></p>
    </div>
    <div data-role="main" class="ui-content">
      <div>
        <form method="post" action="demoform.asp">
          <div class="ui-field-contain">
            <label for="incomeDate">Fecha: </label>
            <input type="date" name="incomeDate" id="incomeDate">
          </div>
          <div class="ui-field-contain">
            <label for="incomeAmount">Importe: </label>
            <input type="text" name="incomeAmount" id="incomeAmount">
          </div>
          <div class="ui-field-contain">
            <label for="clientLabel">Categoria: </label>
            <select name="clientDdl" id="clientDdl" data-native-menu="false"></select>

          </div>
          <div class="ui-field-contain">
            <a href="#AddClient" class="ui-btn ui-shadow ui-corner-all ui-icon-plus ui-btn-icon-notext" data-inline="true" data-mini="true"></a>
          </div>
          <div class="ui-field-contain">
            <label for="noteExpenses">Nota: </label>
            <textarea name="noteExpenses" id="noteExpenses"></textarea>
          </div>
          <div class="ui-field-contain">
            <a href="#menu" data-role="button"  data-theme="b">Guardar</a>
          </div>
        </div>
      </form>
    </div>
    <div data-role="footer" data-position="fixed"  data-id="footer">
      <h1>Footer Text</h1>
    </div>
  </div>

  <div data-role="page" id="account">
    <div data-role="header" data-add-back-btn="true">
      <h1>Estado de cuenta</h1>
      <p><a href="#menu" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right">Menu</a></p>
    </div>
    <div data-role="main" class="ui-content">
      <div>
        <form method="post" action="demoform.asp">
          <div class="ui-grid-b">
            <div class="ui-block-a">Block A</div>
            <div class="ui-block-b">Block B</div>
            <div class="ui-block-c">Block C</div>
          </div>
          <div class="ui-field-contain">
            <a href="#menu" data-role="button"  data-theme="b">Guardar</a>
          </div>
        </form>
      </div>
    </div>
    <div data-role="footer" data-position="fixed"  data-id="footer">
      <h1>Footer Text</h1>
    </div>
  </div>

</body>
</html>
